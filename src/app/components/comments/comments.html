<div class="space-y-3" [formGroup]="commentForm">
    <p class="text-neutral-200 font-semibold mb-2">
        Comentarios: ({{ total }})
    </p>
    <div class="flex gap-2 mb-3 max-sm:mb-3">
        <div class="flex flex-col w-full">
            <input class="flex-1 bg-neutral-800 text-white p-2 rounded border border-neutral-600 max-sm:p-1" formControlName="text" placeholder="Escribe un comentario..." appValidateErrorsInput [formGroup]="commentForm" control="text"/>
        </div>
        <button class="bg-green-600 max-sm:text-sm max-sm:p-1 p-2 rounded disabled:opacity-40 disabled:cursor-not-allowed" (click)="create()" [disabled]="isDisabled()">Enviar</button>
    </div>
    @for (c of comments; track c._id) {
        <div class="bg-neutral-900 rounded-lg p-3 flex gap-3 relative">
            <img [src]="c.avatar" class="size-8 rounded-full shrink-0" />
            <div class="flex-1 min-w-0">
                <div class="flex justify-between items-start">
                    <div class="min-w-0">
                        <p class="font-semibold text-white text-sm truncate">
                            {{ c.firstName }} {{ c.lastName }}
                        </p>
                        <p class="text-neutral-400 text-xs truncate">@{{ c.username }}</p>
                    </div>
                    @if (user._id === c.user_id) {
                        @if (editingId !== c._id) {
                            <button (click)="startEdit(c)" class="bg-red-300 p-1 px-2 rounded-full shrink-0 ml-2 cursor-pointer">
                                <ng-icon name="faSolidPencil" class="text-red-600!"></ng-icon>
                            </button>
                        }
                    }
                </div>
                @if (editingId === c._id) {
                    <textarea
                        class="w-full bg-neutral-800 text-white rounded p-2 mt-2 border border-neutral-600"
                        [formControl]="editForm.controls.text"
                        appValidateErrorsInput
                        [formGroup]="editForm"
                        control="text"
                        >
                    </textarea>
                    <div class="flex gap-2 mt-2">
                        <button (click)="cancelEdit()" class="bg-neutral-500 px-3 py-1 rounded cursor-pointer">Cancelar</button>
                        <button
                            (click)="saveEdit(c._id)"
                            class="px-3 py-1 rounded cursor-pointer transition-all"
                            [class.bg-green-600]="!editForm.invalid"
                            [class.bg-green-950]="editForm.invalid"
                            [class.text-neutral-400]="editForm.invalid"
                            [disabled]="editForm.invalid"
                            >Guardar
                        </button>
                    </div>
                } @else {
                    <p class="text-neutral-300 text-sm mt-1 wrap-break-word">
                        {{ c.text }}
                        @if(c.modified) {
                            <span class="text-xs text-neutral-500">(editado)</span>
                        }
                    </p>
                }
            </div>
        </div>
    }
    @if (loading) {
        <div class="flex justify-center py-4">
            <div class="w-6 h-6 border-4 border-neutral-300 border-t-transparent rounded-full animate-spin-clockwise animate-iteration-count-infinite"></div>
        </div>
    }
    @if (comments.length < total) {
        <div class="text-center">
            <button [disabled]="loading" class="disabled:bg-neutral-400 disabled:cursor-not-allowed disabled:text-neutral-600 px-5 py-2 rounded-md bg-neutral-700 hover:bg-neutral-300 hover:text-neutral-900 text-neutral-200 text-sm font-semibold transition-all duration-200 cursor-pointer" (click)="loadMore()">Cargar m√°s</button>
        </div>
    }
</div>
